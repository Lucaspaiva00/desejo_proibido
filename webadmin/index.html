<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin - Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/admin.css">
    <script src="https://kit.fontawesome.com/a2e0e6ad65.js" crossorigin="anonymous"></script>
</head>

<body>
    <div id="layout"></div>

    <script type="module">
        import { requireAdmin } from "./assets/js/auth-guard.js";
        import { mountLayout, setTitle } from "./assets/js/layout.js";
        import { apiFetch } from "./assets/js/api.js";

        mountLayout("dashboard");
        setTitle("Dashboard");
        await requireAdmin();

        const root = document.getElementById("pageContent");
        root.innerHTML = `
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="p-3 card-dark">
            <div class="text-secondary">Atalho</div>
            <div class="h5 fw-bold">Denúncias</div>
            <a href="denuncias.html" class="btn btn-danger btn-sm mt-2">
              <i class="fa-solid fa-flag"></i> Abrir
            </a>
          </div>
        </div>
        <div class="col-12 col-lg-8">
          <div class="p-3 card-dark">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="h6 fw-bold m-0">Últimas ações</div>
                <div class="text-secondary small">Log do que foi feito no painel</div>
              </div>
              <a href="acoes.html" class="btn btn-outline-light btn-sm">Ver tudo</a>
            </div>
            <div class="mt-3" id="ultAcoes">Carregando...</div>
          </div>
        </div>
      </div>
    `;

        const box = document.getElementById("ultAcoes");
        const r = await apiFetch("/admin/acoes?page=1&limit=5");
        const items = r?.data || [];

        if (!items.length) {
            box.innerHTML = `<div class="text-secondary">Nenhuma ação registrada.</div>`;
        } else {
            box.innerHTML = `
        <div class="table-responsive">
          <table class="table table-sm table-darkish">
            <thead>
              <tr>
                <th>Data</th><th>Tipo</th><th>Admin</th><th>Alvo</th>
              </tr>
            </thead>
            <tbody>
              ${items.map(a => `
                <tr>
                  <td>${new Date(a.criadoEm).toLocaleString()}</td>
                  <td><span class="badge text-bg-dark">${a.tipo}</span></td>
                  <td>${a.admin?.email || "-"}</td>
                  <td>${a.alvo?.email || "-"}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      `;
        }
    </script>
</body>

</html>