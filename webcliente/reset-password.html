<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Redefinir senha – Desejo Proibido</title>
    <link rel="stylesheet" href="css/dating.css" />
</head>

<body>

    <div class="login-card">
        <h2>Redefinir senha</h2>

        <input type="password" id="senha" placeholder="Nova senha" />
        <input type="password" id="senha2" placeholder="Confirmar senha" />

        <button id="btnReset">Redefinir</button>
        <p id="msg"></p>
    </div>

    <script type="module">
        import { apiFetch } from "./js/api.js";

        const params = new URLSearchParams(window.location.search);
        const token = params.get("token");

        const msg = document.getElementById("msg");

        if (!token) {
            msg.textContent = "Token inválido ou ausente.";
            throw new Error("Token ausente");
        }

        document.getElementById("btnReset").onclick = async () => {
            const senha = document.getElementById("senha").value;
            const senha2 = document.getElementById("senha2").value;

            if (!senha || senha.length < 6) {
                msg.textContent = "Senha deve ter no mínimo 6 caracteres";
                return;
            }

            if (senha !== senha2) {
                msg.textContent = "As senhas não coincidem";
                return;
            }

            try {
                await apiFetch("/auth/reset-password", {
                    method: "POST",
                    body: {
                        token,
                        novaSenha: senha,
                    },
                });

                msg.textContent = "Senha redefinida com sucesso!";
                setTimeout(() => {
                    window.location.href = "/index.html";
                }, 1500);
            } catch (e) {
                msg.textContent = e.message || "Erro ao redefinir senha";
            }
        };
    </script>

</body>

</html>