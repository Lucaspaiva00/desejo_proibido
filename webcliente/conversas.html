<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat ‚Äì Desejo Proibido</title>

  <link rel="stylesheet" href="css/dating.css" />
  <link rel="stylesheet" href="css/conversas.css" />

  <style>
    /* ‚úÖ Overlay da Videochamada (FULLSCREEN) */
    .callOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .85);
      display: none;
      align-items: stretch;
      /* importante: estica */
      justify-content: stretch;
      /* importante: estica */
      padding: 0;
      /* sem margem */
      z-index: 99999;

      /* iOS safe area */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }

    .callOverlay.show {
      display: flex;
    }

    /* Card vira ‚Äútela‚Äù */
    .callCard {
      width: 100vw;
      height: 100vh;
      /* fallback */
      height: 100dvh;
      /* iOS/Android moderno */
      background: #0b0b0b;
      border: 0;
      border-radius: 0;
      /* fullscreen */
      overflow: hidden;
      box-shadow: none;
      display: flex;
      flex-direction: column;
    }

    /* Top fixo */
    .callTop {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255, 255, 255, .10);
    }

    /* √Årea de v√≠deo ocupa o resto */
    .callGrid {
      flex: 1 1 auto;
      display: grid;
      grid-template-columns: 1fr;
      /* mobile: 1 coluna */
      grid-template-rows: 1fr;
      /* remoto ocupa tudo */
      gap: 0;
      padding: 0;
      position: relative;
      background: #000;
    }

    /* Remote ocupa a tela */
    .callVideo {
      width: 100%;
      height: 100%;
      background: #000;
      border-radius: 0;
      border: 0;
      overflow: hidden;
      position: relative;
    }

    .callVideo video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* ‚úÖ PiP (minha c√¢mera) por cima no canto */
    #localVideo {
      position: absolute;
      right: 12px;
      top: 12px;
      width: min(34vw, 180px);
      height: min(22vw, 120px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, .18);
      object-fit: cover;
      z-index: 5;
      background: #000;
    }

    /* Garante que o remote fica ‚Äúpor baixo‚Äù */
    #remoteVideo {
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    /* Bot√µes fixos embaixo */
    .callActions {
      flex: 0 0 auto;
      display: flex;
      gap: 10px;
      padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
      border-top: 1px solid rgba(255, 255, 255, .10);
      align-items: center;
      justify-content: center;
      background: rgba(10, 10, 10, .92);
      backdrop-filter: blur(10px);
    }

    .callActions .btn {
      min-width: 0;
      flex: 1;
      max-width: 180px;
    }

    /* ‚úÖ Desktop: volta pro layout 2 telas lado a lado */
    @media (min-width: 900px) {
      .callOverlay {
        padding: 16px;
        align-items: center;
        justify-content: center;
      }

      .callCard {
        width: min(980px, 100%);
        height: auto;
        border: 1px solid rgba(255, 255, 255, .12);
        border-radius: 16px;
        box-shadow: 0 20px 70px rgba(0, 0, 0, .7);
      }

      .callGrid {
        position: static;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto;
        gap: 10px;
        padding: 12px;
      }

      .callVideo {
        position: relative;
        aspect-ratio: 16/9;
        height: auto;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, .12);
      }

      #remoteVideo {
        position: static;
        inset: auto;
      }

      #localVideo {
        position: static;
        width: 100%;
        height: 100%;
        border-radius: 0;
        border: 0;
      }

      .callActions {
        justify-content: flex-end;
      }

      .callActions .btn {
        flex: 0;
        min-width: 140px;
      }
    }
  </style>
</head>

<body>
  <nav class="topnav" role="navigation" aria-label="Navega√ß√£o principal">
    <div class="brand">
      <div class="brand-badge">DP</div>
      <span class="brand-name">Desejo Proibido</span>
    </div>

    <div class="navlinks navlinks-desktop" aria-label="Links do menu">
      <a href="home.html">Feed</a>
      <a href="perfil.html">Perfil</a>
      <a href="fotos.html">Fotos</a>
      <a href="matches.html">Matches</a>
      <a href="conversas.html" class="active">Chat</a>
    </div>

    <div class="spacer"></div>

    <button id="btnSair" class="btn btn-ghost">Sair</button>

    <button class="nav-toggle" id="navToggle" aria-label="Abrir menu" aria-expanded="false" aria-controls="navDrawer">
      <span></span><span></span><span></span>
    </button>
  </nav>

  <div class="nav-overlay" id="navOverlay" aria-hidden="true"></div>

  <aside class="nav-drawer" id="navDrawer" aria-hidden="true">
    <div class="nav-drawer-head">
      <div class="brand">
        <div class="brand-badge">DP</div>
        <span class="brand-name">Desejo Proibido</span>
      </div>

      <button class="iconbtn" id="navClose" aria-label="Fechar menu">
        <span class="xicon"></span>
      </button>
    </div>

    <div class="nav-drawer-links">
      <a href="home.html">Feed</a>
      <a href="perfil.html">Perfil</a>
      <a href="fotos.html">Fotos</a>
      <a href="matches.html">Matches</a>
      <a href="conversas.html" class="active">Chat</a>
    </div>

    <div class="nav-drawer-foot">
      <button id="btnSairMobile" class="btn btn-ghost w100">Sair</button>
    </div>
  </aside>

  <div class="wrap">
    <div class="headRow headRow-premium">
      <div class="hero">
        <h2 class="heroTitle">Conversas Privadas <span class="spark">‚ú®</span></h2>
        <div class="heroSub">Conex√µes exclusivas em tempo real‚Ä¶</div>
        <div id="msg" class="msgline muted"></div>
      </div>

      <div class="heroRight">
        <span class="premiumBadge" id="premiumBadge">üîí Conta Premium Inativa</span>
        <button class="btn btn-primary" id="btnAssinarTopo" type="button">Ativar Premium</button>
      </div>
    </div>

    <div class="chat-layout">
      <aside class="panel left">
        <div class="panel-header">
          <input id="q" class="search" placeholder="Buscar conversa..." />
        </div>
        <div id="lista" class="list"></div>
      </aside>

      <section class="panel right chat" style="position: relative;">
        <div class="chat-top">
          <div class="chat-user">
            <div class="avatarWrap">
              <img id="chatAvatar" class="avatar" alt="avatar" />
              <div class="avatarFallback" id="chatAvatarFallback">DP</div>
            </div>

            <div class="userText">
              <div id="chatNome" class="title">Selecione uma conversa</div>
              <div id="chatSub" class="sub muted"></div>
            </div>
          </div>

          <div class="chat-actions">
            <span class="dp-pill" id="minutosPill">üîí Cr√©dito: -</span>

            <button class="iconbtn" id="btnComprarCreditosTopo" title="Comprar cr√©ditos">üõí</button>

            <button class="iconbtn" id="btnCall" title="Ligar" disabled>üìû</button>
            <button class="iconbtn" id="btnGift" title="Enviar presente" disabled>üéÅ</button>
            <div class="muted" id="chatStatus"></div>
          </div>
        </div>

        <div id="msgs" class="msgs">
          <div class="empty">Escolha uma conversa √† esquerda para ver as mensagens.</div>
        </div>

        <div class="creditwall" id="creditwall" aria-hidden="true">
          <div class="creditwallCard">
            <div class="creditwallTitle">üîí Chat bloqueado</div>
            <div class="creditwallText">
              Para enviar mensagens nesta conversa, voc√™ precisa <b>liberar o chat</b> usando cr√©ditos.
            </div>

            <div class="creditwallRow">
              <button class="btn btn-primary" id="btnLiberarChat" type="button">
                Liberar por <span id="unlockCost">-</span>
              </button>

              <button class="btn btn-ghost" id="btnComprarCreditos" type="button">
                Comprar cr√©ditos
              </button>

              <span class="dp-pill pillSaldo">
                üí∞ Saldo: <b id="saldoCreditos">0</b>
              </span>
            </div>

            <div class="creditwallNote muted">
              * A libera√ß√£o √© cobrada <b>uma √∫nica vez</b> por conversa.
            </div>
          </div>
        </div>

        <div class="paywall" id="paywall" hidden>
          <div class="paywallCard">
            <div class="paywallTitle">Desbloqueie recursos Premium üî•</div>
            <div class="paywallText">
              Para <b>liga√ß√µes</b> e <b>presentes</b>, voc√™ precisa estar Premium.
              Comprando cr√©ditos, sua conta ativa o Premium automaticamente enquanto houver saldo.
            </div>

            <div class="paywallActions">
              <button class="btn btn-primary" id="btnAssinar" type="button">Comprar cr√©ditos</button>
              <button class="btn btn-ghost" id="btnEntendi" type="button">Entendi</button>
            </div>

            <div class="paywallNote muted">
              Ap√≥s comprar, a libera√ß√£o acontece automaticamente.
            </div>
          </div>
        </div>

        <div class="composer">
          <textarea id="texto" placeholder="Digite uma mensagem..." disabled></textarea>
          <button id="btnEnviar" class="btn btn-primary" disabled>Enviar</button>
        </div>
      </section>
    </div>
  </div>

  <div class="dp-modal-overlay" id="giftOverlay" aria-hidden="true">
    <div class="dp-modal" role="dialog" aria-modal="true" aria-label="Enviar presente">
      <div class="dp-modal-head">
        <div class="dp-modal-title">Enviar presente üéÅ</div>
        <button class="dp-modal-close" id="giftClose" aria-label="Fechar">‚úï</button>
      </div>
      <div class="dp-modal-body">
        <div class="muted">Escolha um presente para enviar nesta conversa.</div>
        <div id="giftList" class="dp-gifts">Carregando...</div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Overlay da chamada (WhatsApp-like) -->
  <div class="callOverlay" id="callOverlay" aria-hidden="true">
    <div class="callCard">
      <div class="callTop">
        <div>
          <div class="callTitle" id="callTitle">üìπ Videochamada</div>
          <div class="callSub" id="callSub">Conectando‚Ä¶</div>
        </div>
        <button class="iconbtn" id="btnCallClose" title="Fechar">‚úï</button>
      </div>

      <!-- ‚úÖ Remote em tela cheia + Local miniatura -->
      <div class="callGrid">
        <div class="callVideo">
          <video id="remoteVideo" autoplay playsinline></video>
          <video id="localVideo" autoplay playsinline muted></video>
        </div>
      </div>

      <div class="callActions">
        <button class="btn btn-ghost" id="btnMute" type="button">üéôÔ∏è Mudo</button>
        <button class="btn btn-ghost" id="btnCam" type="button">üì∑ C√¢mera</button>
        <button class="btn btn-primary" id="btnHangup" type="button">Encerrar</button>
      </div>
    </div>
  </div>

  <!-- Socket.IO client -->
  <script src="/socket.io/socket.io.js"></script>

  <!-- ‚úÖ cache-bust -->
  <script type="module" src="js/conversas.js?v=20260209-2"></script>

  <script>
    const navToggle = document.getElementById("navToggle");
    const navDrawer = document.getElementById("navDrawer");
    const navOverlay = document.getElementById("navOverlay");
    const navClose = document.getElementById("navClose");

    function openNav() {
      navDrawer.classList.add("open");
      navOverlay.classList.add("show");
      navToggle.classList.add("open");
      navToggle.setAttribute("aria-expanded", "true");
      navDrawer.setAttribute("aria-hidden", "false");
      navOverlay.setAttribute("aria-hidden", "false");
      document.body.classList.add("no-scroll");
    }

    function closeNav() {
      navDrawer.classList.remove("open");
      navOverlay.classList.remove("show");
      navToggle.classList.remove("open");
      navToggle.setAttribute("aria-expanded", "false");
      navDrawer.setAttribute("aria-hidden", "true");
      navOverlay.setAttribute("aria-hidden", "true");
      document.body.classList.remove("no-scroll");
    }

    navToggle?.addEventListener("click", () => {
      if (navDrawer.classList.contains("open")) closeNav();
      else openNav();
    });

    navOverlay?.addEventListener("click", closeNav);
    navClose?.addEventListener("click", closeNav);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeNav();
    });

    const btnSair = document.getElementById("btnSair");
    const btnSairMobile = document.getElementById("btnSairMobile");
    if (btnSair && btnSairMobile) {
      btnSairMobile.addEventListener("click", () => btnSair.click());
    }
  </script>
</body>

</html>